source $(dirname $0)/xcp-begin

plist_path=$(/usr/bin/xcrun xcodebuild -showBuildSettings -target $1 2>/dev/null | grep "INFOPLIST_FILE" | sed 's/[ ]*INFOPLIST_FILE = //')
if [ -z "$plist_path" ]; then
	echo "[!] Not found plist of given target. $1"; exit 1
fi

VERSION=$(/usr/libexec/PlistBuddy -c "Print CFBundleShortVersionString" "$plist_path")  
BUILD_NUM=$(/usr/libexec/PlistBuddy -c "Print CFBundleVersion" "$plist_path")  
TARGET_TAG=submit/s"$BUILD_NUM"_"$VERSION"

git push -f origin "$CURRENT_BRANCH":release-submit && git push origin $CURRENT_BRANCH
git tag "$TARGET_TAG" && git push origin "$TARGET_TAG"

source $(dirname $0)/xcp-end